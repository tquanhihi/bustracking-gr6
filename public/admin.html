<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>SSB 1.0 - Admin Panel</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <div class="sidebar" id="left-sidebar">
    <h2>SSB Admin</h2>
    <ul id="main-nav">
      <!-- === QU·∫¢N L√ù H·ªÜ TH·ªêNG === -->
      <li data-page="admin-dashboard">üìä <span>Dashboard</span></li>
      <li data-page="admin-users">üë• <span>Qu·∫£n l√Ω ng∆∞·ªùi d√πng</span></li>
      <li data-page="admin-managers">üëî <span>Qu·∫£n l√Ω c·∫•p qu·∫£n l√Ω</span></li>
      <li data-page="admin-drivers">üöå <span>Qu·∫£n l√Ω t√†i x·∫ø</span></li>
      <li data-page="admin-parents">üë™ <span>Qu·∫£n l√Ω ph·ª• huynh</span></li>
      <li data-page="admin-settings">‚öôÔ∏è <span>C√†i ƒë·∫∑t h·ªá th·ªëng</span></li>
      <li data-page="admin-analytics">üìà <span>Th·ªëng k√™ & b√°o c√°o</span></li>
      <li data-page="admin-logs">üìã <span>Nh·∫≠t k√Ω ho·∫°t ƒë·ªông</span></li>
    </ul>
    <button class="logout-btn" onclick="logout()">ƒêƒÉng xu·∫•t</button>
  </div>

  <div class="main-content" id="main-content-area">
    <div class="app" id="app">
      <main class="main">
        <div class="container">
          <div class="mobile-top">
            <button class="open-sb" id="open-sb">‚ò∞ Menu</button>
            <div style="font-weight:700">SSB Admin</div>
            <div style="margin-left:auto;display:flex;gap:8px">
              <button class="btn ghost" id="btn-refresh">üîÑ L√†m m·ªõi</button>
            </div>
          </div>

          <header class="top">
            <h1 id="page-title">Dashboard</h1>
            <div class="controls">
              <div class="chip" id="role-indicator">Admin</div>
              <div class="chip" id="timestamp-indicator">Offline</div>
            </div>
          </header>

          <div class="grid">
            <section>
              <div class="card" id="page-content">

                <!-- Dashboard View -->
                <div id="admin-dashboard-view">
                  <div style="display:flex;gap:12px;align-items:center;margin-bottom:16px">
                    <div style="flex:1">
                      <h3>T·ªïng quan h·ªá th·ªëng</h3>
                      <div style="display:flex;gap:10px;margin-top:8px;flex-wrap:wrap">
                        <div style="flex:1;min-width:140px;background:#f9fafb;padding:12px;border-radius:8px">
                          <div class="muted">T·ªïng ng∆∞·ªùi d√πng</div>
                          <div style="font-weight:700;font-size:20px" id="total-users">0</div>
                        </div>
                        <div style="flex:1;min-width:140px;background:#f9fafb;padding:12px;border-radius:8px">
                          <div class="muted">Qu·∫£n l√Ω</div>
                          <div style="font-weight:700;font-size:20px" id="total-managers">0</div>
                        </div>
                        <div style="flex:1;min-width:140px;background:#f9fafb;padding:12px;border-radius:8px">
                          <div class="muted">T√†i x·∫ø</div>
                          <div style="font-weight:700;font-size:20px" id="total-drivers">0</div>
                        </div>
                        <div style="flex:1;min-width:140px;background:#f9fafb;padding:12px;border-radius:8px">
                          <div class="muted">Ph·ª• huynh</div>
                          <div style="font-weight:700;font-size:20px" id="total-parents">0</div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <hr style="margin:16px 0" />

                  <div style="display:flex;gap:12px">
                    <div style="flex:1">
                      <h3>Ho·∫°t ƒë·ªông g·∫ßn ƒë√¢y</h3>
                      <table>
                        <thead><tr><th>Th·ªùi gian</th><th>Lo·∫°i</th><th>Chi ti·∫øt</th><th>Tr·∫°ng th√°i</th></tr></thead>
                        <tbody id="dashboard-activity-table"></tbody>
                      </table>
                    </div>
                  </div>
                </div>

                <!-- User Management View -->
                <div id="admin-users-view" class="hidden">
                  <h3>Qu·∫£n l√Ω ng∆∞·ªùi d√πng</h3>
                  <div class="muted">Xem v√† qu·∫£n l√Ω t·∫•t c·∫£ t√†i kho·∫£n ng∆∞·ªùi d√πng trong h·ªá th·ªëng</div>
                  <div style="margin-top:12px;display:flex;gap:8px">
                    <div style="flex:1">
                      <table>
                        <thead><tr><th>ID</th><th>T√™n</th><th>Email</th><th>Lo·∫°i</th><th>Tr·∫°ng th√°i</th><th>H√†nh ƒë·ªông</th></tr></thead>
                        <tbody id="users-table"></tbody>
                      </table>
                    </div>
                  </div>
                </div>

                <!-- Manager Management View -->
                <div id="admin-managers-view" class="hidden">
                  <h3>Qu·∫£n l√Ω c·∫•p qu·∫£n l√Ω</h3>
                  <div style="display:flex;gap:12px">
                    <div style="flex:1">
                      <table>
                        <thead><tr><th>ID</th><th>T√™n</th><th>Email</th><th>S·ªë ƒëi·ªán tho·∫°i</th><th>Ng√†y t·∫°o</th><th>H√†nh ƒë·ªông</th></tr></thead>
                        <tbody id="managers-table"></tbody>
                      </table>
                    </div>
                    <div style="width:320px">
                      <div class="card">
                        <h3>Th√™m qu·∫£n l√Ω</h3>
                        <div style="display:flex;flex-direction:column;gap:8px">
                          <input id="mgr-name" placeholder="T√™n qu·∫£n l√Ω" />
                          <input id="mgr-email" placeholder="Email" type="email" />
                          <input id="mgr-phone" placeholder="S·ªë ƒëi·ªán tho·∫°i" />
                          <input id="mgr-password" placeholder="M·∫≠t kh·∫©u" type="password" />
                          <button class="btn" id="add-manager">Th√™m</button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Driver Management View -->
                <div id="admin-drivers-view" class="hidden">
                  <h3>Qu·∫£n l√Ω t√†i x·∫ø</h3>
                  <div style="display:flex;gap:12px">
                    <div style="flex:1">
                      <table>
                        <thead><tr><th>ID</th><th>T√™n</th><th>Email</th><th>B·∫±ng l√°i</th><th>Tr·∫°ng th√°i</th><th>H√†nh ƒë·ªông</th></tr></thead>
                        <tbody id="drivers-table"></tbody>
                      </table>
                    </div>
                    <div style="width:320px">
                      <div class="card">
                        <h3>Th√™m t√†i x·∫ø</h3>
                        <div style="display:flex;flex-direction:column;gap:8px">
                          <input id="drv-name" placeholder="T√™n t√†i x·∫ø" />
                          <input id="drv-email" placeholder="Email" type="email" />
                          <input id="drv-license" placeholder="S·ªë b·∫±ng l√°i" />
                          <input id="drv-phone" placeholder="S·ªë ƒëi·ªán tho·∫°i" />
                          <button class="btn" id="add-driver">Th√™m</button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Parent Management View -->
                <div id="admin-parents-view" class="hidden">
                  <h3>Qu·∫£n l√Ω ph·ª• huynh</h3>
                  <div style="display:flex;gap:12px">
                    <div style="flex:1">
                      <table>
                        <thead><tr><th>ID</th><th>T√™n</th><th>Email</th><th>S·ªë ƒëi·ªán tho·∫°i</th><th>S·ªë con</th><th>H√†nh ƒë·ªông</th></tr></thead>
                        <tbody id="parents-table"></tbody>
                      </table>
                    </div>
                    <div style="width:320px">
                      <div class="card">
                        <h3>Xem chi ti·∫øt</h3>
                        <div style="display:flex;flex-direction:column;gap:8px">
                          <input id="parent-search" placeholder="T√¨m ki·∫øm ph·ª• huynh..." />
                          <button class="btn" id="search-parent">T√¨m</button>
                          <div id="parent-detail" style="margin-top:12px;font-size:13px"></div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- System Settings View -->
                <div id="admin-settings-view" class="hidden">
                  <h3>C√†i ƒë·∫∑t h·ªá th·ªëng</h3>
                  <div style="display:flex;gap:12px">
                    <div style="flex:1">
                      <div class="card">
                        <h3>C·∫•u h√¨nh c∆° b·∫£n</h3>
                        <div style="display:flex;flex-direction:column;gap:12px">
                          <div>
                            <label style="display:block;margin-bottom:4px;font-weight:500">T√™n h·ªá th·ªëng</label>
                            <input id="sys-name" placeholder="SSB 1.0" style="width:100%" />
                          </div>
                          <div>
                            <label style="display:block;margin-bottom:4px;font-weight:500">Email h·ªó tr·ª£</label>
                            <input id="sys-email" placeholder="support@ssb.local" type="email" style="width:100%" />
                          </div>
                          <div>
                            <label style="display:block;margin-bottom:4px;font-weight:500">S·ªë ƒëi·ªán tho·∫°i h·ªó tr·ª£</label>
                            <input id="sys-phone" placeholder="024-xxxx-xxxx" style="width:100%" />
                          </div>
                          <div>
                            <label style="display:block;margin-bottom:4px;font-weight:500">Google Maps API Key</label>
                            <input id="sys-gmaps" placeholder="YOUR_API_KEY" type="password" style="width:100%" />
                          </div>
                          <button class="btn" id="save-settings">L∆∞u c·∫•u h√¨nh</button>
                        </div>
                      </div>
                    </div>
                    <div style="width:320px">
                      <div class="card">
                        <h3>Qu·∫£n l√Ω</h3>
                        <div style="display:flex;flex-direction:column;gap:8px">
                          <button class="btn ghost" id="btn-backup">üíæ Sao l∆∞u d·ªØ li·ªáu</button>
                          <button class="btn ghost" id="btn-reset">‚ö†Ô∏è ƒê·∫∑t l·∫°i d·ªØ li·ªáu</button>
                          <button class="btn ghost" id="btn-export-data">üì• Xu·∫•t d·ªØ li·ªáu</button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Analytics & Reports View -->
                <div id="admin-analytics-view" class="hidden">
                  <h3>Th·ªëng k√™ & b√°o c√°o</h3>
                  <div style="display:flex;gap:12px;margin-top:12px">
                    <div style="flex:1">
                      <div class="card">
                        <h3>Th·ªëng k√™ ng∆∞·ªùi d√πng</h3>
                        <div style="display:flex;gap:10px;margin-top:12px">
                          <div style="flex:1;background:#f9fafb;padding:12px;border-radius:8px">
                            <div class="muted">Qu·∫£n l√Ω</div>
                            <div style="font-weight:700;font-size:18px" id="stats-mgr">0</div>
                          </div>
                          <div style="flex:1;background:#f9fafb;padding:12px;border-radius:8px">
                            <div class="muted">T√†i x·∫ø</div>
                            <div style="font-weight:700;font-size:18px" id="stats-drv">0</div>
                          </div>
                          <div style="flex:1;background:#f9fafb;padding:12px;border-radius:8px">
                            <div class="muted">Ph·ª• huynh</div>
                            <div style="font-weight:700;font-size:18px" id="stats-par">0</div>
                          </div>
                        </div>
                      </div>

                      <div class="card" style="margin-top:12px">
                        <h3>Xu·∫•t b√°o c√°o</h3>
                        <div style="display:flex;flex-direction:column;gap:8px;margin-top:12px">
                          <select id="report-type">
                            <option value="">-- Ch·ªçn lo·∫°i b√°o c√°o --</option>
                            <option value="users">B√°o c√°o ng∆∞·ªùi d√πng</option>
                            <option value="activity">B√°o c√°o ho·∫°t ƒë·ªông</option>
                            <option value="routes">B√°o c√°o tuy·∫øn ƒë∆∞·ªùng</option>
                            <option value="schedules">B√°o c√°o l·ªãch tr√¨nh</option>
                          </select>
                          <select id="report-period">
                            <option value="today">H√¥m nay</option>
                            <option value="week">Tu·∫ßn n√†y</option>
                            <option value="month">Th√°ng n√†y</option>
                            <option value="all">To√†n b·ªô</option>
                          </select>
                          <button class="btn" id="generate-report">T·∫°o b√°o c√°o</button>
                        </div>
                      </div>
                    </div>
                    <div style="width:360px">
                      <div class="card">
                        <h3>B√°o c√°o g·∫ßn ƒë√¢y</h3>
                        <div id="recent-reports" style="max-height:300px;overflow:auto"></div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Activity Logs View -->
                <div id="admin-logs-view" class="hidden">
                  <h3>Nh·∫≠t k√Ω ho·∫°t ƒë·ªông</h3>
                  <div style="display:flex;gap:12px;margin-top:12px">
                    <div style="flex:1">
                      <div class="card">
                        <div style="display:flex;gap:8px;margin-bottom:12px">
                          <input id="log-search" placeholder="T√¨m ki·∫øm nh·∫≠t k√Ω..." style="flex:1" />
                          <select id="log-filter" style="min-width:120px">
                            <option value="">-- T·∫•t c·∫£ --</option>
                            <option value="login">ƒêƒÉng nh·∫≠p</option>
                            <option value="create">T·∫°o</option>
                            <option value="update">C·∫≠p nh·∫≠t</option>
                            <option value="delete">X√≥a</option>
                            <option value="error">L·ªói</option>
                          </select>
                          <button class="btn" id="apply-log-filter">L·ªçc</button>
                        </div>
                        <table>
                          <thead><tr><th>Th·ªùi gian</th><th>Ng∆∞·ªùi d√πng</th><th>H√†nh ƒë·ªông</th><th>Chi ti·∫øt</th></tr></thead>
                          <tbody id="logs-table"></tbody>
                        </table>
                      </div>
                    </div>
                  </div>
                </div>

              </div>
            </section>

            <aside>
              <div class="card">
                <h3>T√°c v·ª• nhanh</h3>
                <div style="display:flex;flex-direction:column;gap:8px;margin-top:8px">
                  <button class="btn" id="action-add-user">‚ûï Th√™m ng∆∞·ªùi d√πng</button>
                  <button class="btn ghost" id="action-view-reports">üìä Xem b√°o c√°o</button>
                  <button class="btn ghost" id="action-system-health">‚ù§Ô∏è Ki·ªÉm tra h·ªá th·ªëng</button>
                </div>
              </div>

              <div style="margin-top:12px" class="card">
                <h3>Th√¥ng tin h·ªá th·ªëng</h3>
                <div class="muted" style="font-size:12px">
                  <div>Phi√™n b·∫£n: 1.0.0</div>
                  <div>Tr·∫°ng th√°i: <span style="color:#059669">Ho·∫°t ƒë·ªông</span></div>
                  <div>Database: <span id="db-status">Ki·ªÉm tra...</span></div>
                  <div style="margin-top:8px;padding-top:8px;border-top:1px solid #e2e8f0">
                    Phi√™n l√†m vi·ªác: <span id="session-info">‚Äî</span>
                  </div>
                </div>
              </div>

              <div style="margin-top:12px" class="card">
                <h3>Ghi ch√∫</h3>
                <div class="muted" style="font-size:12px">
                  Admin panel cung c·∫•p to√†n quy·ªÅn qu·∫£n l√Ω h·ªá th·ªëng. S·ª≠ d·ª•ng c·∫©n th·∫≠n c√°c t√°c v·ª• nguy hi·ªÉm nh∆∞ x√≥a d·ªØ li·ªáu.
                </div>
              </div>
            </aside>

          </div>

        </div>
      </main>
    </div>
  </div>

  <script>
    // === GLOBAL STATE ===
    let adminState = {
      users: [],
      managers: [],
      drivers: [],
      parents: [],
      activityLogs: [],
      settings: {}
    };

    let currentLogFilter = '';

    // === INITIALIZATION ===
    document.addEventListener('DOMContentLoaded', () => {
      // Check admin role
      const role = localStorage.getItem('role');
      if (role !== 'admin') {
        alert('Ch·ªâ qu·∫£n tr·ªã vi√™n m·ªõi c√≥ th·ªÉ truy c·∫≠p trang n√†y!');
        window.location.href = 'login.html';
        return;
      }

      document.getElementById('role-indicator').textContent = 'Admin';
      document.getElementById('session-info').textContent = 
        new Date().toLocaleString('vi-VN');

      // Load initial data
      loadDashboardData();
      loadAllUsers();
      updateTimestamp();

      // Set up navigation
      setupNavigation();

      // Set up event listeners
      setupEventListeners();

      // Refresh button
      document.getElementById('btn-refresh').addEventListener('click', () => {
        loadDashboardData();
        loadAllUsers();
      });

      // Show first page
      document.querySelector('.sidebar li').click();
    });

    // === LOAD DATA FUNCTIONS ===
    function loadDashboardData() {
      // Simulated data loading - replace with actual API calls
      const mockData = {
        totalUsers: 45,
        totalManagers: 3,
        totalDrivers: 12,
        totalParents: 30,
        activities: [
          { time: new Date().toLocaleTimeString(), type: 'login', detail: 'Manager 01 ƒëƒÉng nh·∫≠p', status: 'th√†nh c√¥ng' },
          { time: new Date(Date.now() - 60000).toLocaleTimeString(), type: 'create', detail: 'T·∫°o t√†i x·∫ø m·ªõi', status: 'th√†nh c√¥ng' },
          { time: new Date(Date.now() - 300000).toLocaleTimeString(), type: 'update', detail: 'C·∫≠p nh·∫≠t l·ªãch tr√¨nh', status: 'th√†nh c√¥ng' }
        ]
      };

      document.getElementById('total-users').textContent = mockData.totalUsers;
      document.getElementById('total-managers').textContent = mockData.totalManagers;
      document.getElementById('total-drivers').textContent = mockData.totalDrivers;
      document.getElementById('total-parents').textContent = mockData.totalParents;

      document.getElementById('stats-mgr').textContent = mockData.totalManagers;
      document.getElementById('stats-drv').textContent = mockData.totalDrivers;
      document.getElementById('stats-par').textContent = mockData.totalParents;

      const actTable = document.getElementById('dashboard-activity-table');
      actTable.innerHTML = mockData.activities.map(a => `
        <tr>
          <td style="font-size:12px">${a.time}</td>
          <td><span style="background:#e0e7ff;color:#4c1d95;padding:2px 8px;border-radius:4px;font-size:12px">${a.type}</span></td>
          <td>${a.detail}</td>
          <td><span style="color:#059669;font-weight:500">${a.status}</span></td>
        </tr>
      `).join('');

      adminState.users = Array(mockData.totalUsers).fill(0).map((_, i) => ({
        id: i + 1,
        name: `User ${i + 1}`,
        email: `user${i + 1}@ssb.local`,
        type: ['manager', 'driver', 'parent'][Math.floor(Math.random() * 3)],
        status: Math.random() > 0.2 ? 'active' : 'inactive',
        createdAt: new Date(Date.now() - Math.random() * 30 * 24 * 60 * 60 * 1000).toLocaleDateString('vi-VN')
      }));

      adminState.managers = adminState.users.filter(u => u.type === 'manager');
      adminState.drivers = adminState.users.filter(u => u.type === 'driver');
      adminState.parents = adminState.users.filter(u => u.type === 'parent');

      renderTables();
    }

    function loadAllUsers() {
      // Placeholder for API call to load users
      console.log('Loading all users...');
    }

    function renderTables() {
      // Render users table
      const usersTable = document.getElementById('users-table');
      usersTable.innerHTML = adminState.users.map(u => `
        <tr>
          <td>#${u.id}</td>
          <td>${u.name}</td>
          <td style="font-size:12px">${u.email}</td>
          <td><span style="background:#f3e8ff;color:#6b21a8;padding:2px 6px;border-radius:4px;font-size:12px">
            ${u.type === 'manager' ? 'üëî Qu·∫£n l√Ω' : u.type === 'driver' ? 'üöå T√†i x·∫ø' : 'üë™ Ph·ª• huynh'}
          </span></td>
          <td><span style="color:${u.status === 'active' ? '#059669' : '#dc2626'}">${u.status === 'active' ? 'Ho·∫°t ƒë·ªông' : 'V√¥ hi·ªáu h√≥a'}</span></td>
          <td><button class="btn ghost" style="font-size:12px">S·ª≠a</button></td>
        </tr>
      `).join('');

      // Render managers table
      const mgrsTable = document.getElementById('managers-table');
      mgrsTable.innerHTML = adminState.managers.map(m => `
        <tr>
          <td>#${m.id}</td>
          <td>${m.name}</td>
          <td style="font-size:12px">${m.email}</td>
          <td>024-xxxx-xxxx</td>
          <td style="font-size:12px">${m.createdAt}</td>
          <td>
            <button class="btn ghost" style="font-size:12px;margin-right:4px">S·ª≠a</button>
            <button class="btn ghost" style="font-size:12px">X√≥a</button>
          </td>
        </tr>
      `).join('');

      // Render drivers table
      const drvsTable = document.getElementById('drivers-table');
      drvsTable.innerHTML = adminState.drivers.map(d => `
        <tr>
          <td>#${d.id}</td>
          <td>${d.name}</td>
          <td style="font-size:12px">${d.email}</td>
          <td>123456789</td>
          <td><span style="color:#059669">Ho·∫°t ƒë·ªông</span></td>
          <td>
            <button class="btn ghost" style="font-size:12px;margin-right:4px">S·ª≠a</button>
            <button class="btn ghost" style="font-size:12px">X√≥a</button>
          </td>
        </tr>
      `).join('');

      // Render parents table
      const partsTable = document.getElementById('parents-table');
      partsTable.innerHTML = adminState.parents.map(p => `
        <tr>
          <td>#${p.id}</td>
          <td>${p.name}</td>
          <td style="font-size:12px">${p.email}</td>
          <td>0912-xxx-xxx</td>
          <td>${Math.floor(Math.random() * 3) + 1}</td>
          <td>
            <button class="btn ghost" style="font-size:12px;margin-right:4px">Xem</button>
            <button class="btn ghost" style="font-size:12px">X√≥a</button>
          </td>
        </tr>
      `).join('');

      // Render logs table (sample data)
      const logsTable = document.getElementById('logs-table');
      const sampleLogs = [
        { time: '14:23:45', user: 'admin@ssb.local', action: 'login', detail: 'ƒêƒÉng nh·∫≠p th√†nh c√¥ng' },
        { time: '14:15:20', user: 'mgr001@ssb.local', action: 'create', detail: 'T·∫°o t√†i x·∫ø m·ªõi' },
        { time: '14:10:10', user: 'mgr001@ssb.local', action: 'update', detail: 'C·∫≠p nh·∫≠t l·ªãch tr√¨nh' },
        { time: '14:05:33', user: 'admin@ssb.local', action: 'delete', detail: 'X√≥a ng∆∞·ªùi d√πng kh√¥ng ho·∫°t ƒë·ªông' },
      ];
      logsTable.innerHTML = sampleLogs.map(log => `
        <tr>
          <td style="font-size:12px">${log.time}</td>
          <td>${log.user}</td>
          <td><span style="background:#dcfce7;color:#166534;padding:2px 6px;border-radius:4px;font-size:12px">${log.action}</span></td>
          <td style="font-size:12px">${log.detail}</td>
        </tr>
      `).join('');
    }

    function updateTimestamp() {
      setInterval(() => {
        const now = new Date();
        document.getElementById('timestamp-indicator').textContent = now.toLocaleTimeString('vi-VN');
      }, 1000);
    }

    // === SETUP FUNCTIONS ===
    function setupNavigation() {
      document.querySelectorAll('.sidebar li').forEach(li => {
        li.addEventListener('click', () => {
          document.querySelectorAll('.sidebar li').forEach(x => x.classList.remove('active'));
          li.classList.add('active');
          document.querySelectorAll('[id$="-view"]').forEach(v => v.classList.add('hidden'));
          const view = document.getElementById(li.dataset.page + '-view');
          if (view) view.classList.remove('hidden');
          document.getElementById('page-title').textContent = li.querySelector('span').textContent;
        });
      });
    }

    function setupEventListeners() {
      // Add Manager
      document.getElementById('add-manager')?.addEventListener('click', () => {
        const name = document.getElementById('mgr-name').value;
        const email = document.getElementById('mgr-email').value;
        if (name && email) {
          alert(`Th√™m qu·∫£n l√Ω "${name}" th√†nh c√¥ng!`);
          document.getElementById('mgr-name').value = '';
          document.getElementById('mgr-email').value = '';
          document.getElementById('mgr-phone').value = '';
          document.getElementById('mgr-password').value = '';
        }
      });

      // Add Driver
      document.getElementById('add-driver')?.addEventListener('click', () => {
        const name = document.getElementById('drv-name').value;
        const email = document.getElementById('drv-email').value;
        if (name && email) {
          alert(`Th√™m t√†i x·∫ø "${name}" th√†nh c√¥ng!`);
          document.getElementById('drv-name').value = '';
          document.getElementById('drv-email').value = '';
          document.getElementById('drv-license').value = '';
          document.getElementById('drv-phone').value = '';
        }
      });

      // Search Parent
      document.getElementById('search-parent')?.addEventListener('click', () => {
        const search = document.getElementById('parent-search').value;
        if (search) {
          document.getElementById('parent-detail').innerHTML = `
            <strong>Ph·ª• huynh: ${search}</strong><br>
            Email: parent@ssb.local<br>
            SƒêT: 0912-345-678<br>
            S·ªë con: 2<br>
            <br>
            <strong>Con em:</strong><br>
            1. Nguy·ªÖn A (ID: S001) - L·ªõp 1A<br>
            2. Nguy·ªÖn B (ID: S002) - L·ªõp 2B
          `;
        }
      });

      // Generate Report
      document.getElementById('generate-report')?.addEventListener('click', () => {
        const type = document.getElementById('report-type').value;
        const period = document.getElementById('report-period').value;
        if (type) {
          alert(`ƒêang t·∫°o b√°o c√°o ${type} cho ${period}...`);
          const reportItem = `<div style="padding:8px;border-bottom:1px solid #e2e8f0;font-size:12px">
            üìÑ B√°o c√°o ${type} (${period})<br>
            <span style="color:#94a3b8">${new Date().toLocaleString('vi-VN')}</span>
          </div>`;
          const reportsDiv = document.getElementById('recent-reports');
          reportsDiv.innerHTML = reportItem + reportsDiv.innerHTML;
        }
      });

      // Save Settings
      document.getElementById('save-settings')?.addEventListener('click', () => {
        alert('C·∫•u h√¨nh h·ªá th·ªëng ƒë√£ ƒë∆∞·ª£c l∆∞u!');
      });

      // Backup, Reset, Export buttons
      document.getElementById('btn-backup')?.addEventListener('click', () => {
        alert('ƒêang sao l∆∞u d·ªØ li·ªáu...');
      });
      document.getElementById('btn-reset')?.addEventListener('click', () => {
        if (confirm('‚ö†Ô∏è B·∫°n ch·∫Øc ch·∫Øn mu·ªën x√≥a t·∫•t c·∫£ d·ªØ li·ªáu? H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c!')) {
          alert('D·ªØ li·ªáu ƒë√£ ƒë∆∞·ª£c ƒë·∫∑t l·∫°i.');
        }
      });
      document.getElementById('btn-export-data')?.addEventListener('click', () => {
        alert('ƒêang xu·∫•t d·ªØ li·ªáu...');
      });

      // Quick actions
      document.getElementById('action-add-user')?.addEventListener('click', () => {
        document.querySelector('[data-page="admin-managers"]').click();
      });
      document.getElementById('action-view-reports')?.addEventListener('click', () => {
        document.querySelector('[data-page="admin-analytics"]').click();
      });

      // Log filter
      document.getElementById('apply-log-filter')?.addEventListener('click', () => {
        currentLogFilter = document.getElementById('log-filter').value;
        alert(`L·ªçc nh·∫≠t k√Ω theo: ${currentLogFilter || 'T·∫•t c·∫£'}`);
      });
    }

    // === UTILITY FUNCTIONS ===
    window.logout = () => {
      localStorage.removeItem('role');
      alert('ƒê√£ ƒëƒÉng xu·∫•t!');
      window.location.href = 'login.html';
    };

    // Check database connection
    async function checkDatabaseStatus() {
      try {
        const res = await fetch('/api/health');
        const data = await res.json();
        document.getElementById('db-status').textContent = data.database ? '‚úì OK' : '‚úó L·ªói';
        document.getElementById('db-status').style.color = data.database ? '#059669' : '#dc2626';
      } catch (err) {
        document.getElementById('db-status').textContent = '‚úó Kh√¥ng k·∫øt n·ªëi';
        document.getElementById('db-status').style.color = '#dc2626';
      }
    }

    checkDatabaseStatus();
  </script>
</body>
</html>
